<?php
/*
JSON_SQL_Bridge 1.0
Copyright 2016 Frank Vanden berghen
All Right reserved.

JSON_SQL_Bridge is not a free software. The JSON_SQL_Bridge software is NOT licensed under the "Apache License". 
If you are interested in distributing, reselling, modifying, contibuting or in general creating 
any derivative work from JSON_SQL_Bridge, please contact Frank Vanden Berghen at frank@timi.eu.
*/
namespace kibella; function O6l($l6k,$O4t) { $l9m=FALSE; if ($O4t) { $l9n=$l6k["responseFileFinal"]; $O9n=$l6k["responseFileTmp"]; $l29=checkdirexistsorcreate(CACHEDIR); if ($l29 === FALSE) { O29( __FUNCTION__ ,lc,O76(CACHEDIR).l9o()); return FALSE; } if (file_exists($l9n) && !l3l($l9n)) { $l9m=TRUE; } else if (file_exists($O9n)) { O9m($l9n); if (file_exists($l9n)) { $l9m=TRUE; } } } return $l9m; } function l6n($l6k,$O4t) { if (file_exists($l6k["responseFileTmp"]) === TRUE) { $O9k=O9o($l6k); if ($O9k !== FALSE && PHP_SAPI !== "cli") { if ($l6k["responseFileFinal"] !== l6x(l9)) { setrawcookie(l9,$l6k["responseFileFinal"],@strtotime("+365 days"),"/".APPDIRNAME."/"); setrawcookie(O9,time(),@strtotime("+365 days"),"/".APPDIRNAME."/"); setrawcookie(la,$O4t*1,@strtotime("+365 days"),"/".APPDIRNAME."/"); } } } } function O6k($O22,$l6j) { if (is_string($l6j)) { $l9p=$l6j; } else { $l9p=serialize($l6j); } $l9n=CACHEDIR."/query_".$O22.O14.md5($O22."\n".$l9p).".json"; $O9p="_tmp"; $O9n= "$l9n$O9p"; $l6k=array("responseFileFinal" => $l9n,"responseFileTmp" => $O9n); return $l6k; } function l9j($O3l) { $l9q=substr($O3l,strrpos($O3l,O14)+1); $O9q=strrpos($l9q,"."); if ($O9q>0) { $O54=substr($l9q,0,$O9q); } else { $O54=$l9q; } return $O54; } function l6x($l9r) { if ( isset ($_COOKIE[$l9r])) { return $_COOKIE[$l9r]; } else { return ""; } } function O6n($O3l,$O9r=5) { $O9k=FALSE; if ($O3l !== NULL && $O3l !== FALSE && $O3l !== "") { $l9s=time(); $O9s=strlen(ob_get_contents()); while ($O9k === FALSE && (time()-$l9s)<=$O9r) { @readfile($O3l); if (PHP_SAPI === "cli" || strlen(ob_get_contents())>$O9s && @filesize($O3l)>0) $O9k=TRUE; } } return $O9k; } function O9o($l6k,$O9r=5) { $O9k=FALSE; $l9s=time(); while ($O9k === FALSE && (time()-$l9s)<=$O9r) { $O9k=@rename($l6k["responseFileTmp"],$l6k["responseFileFinal"]); } return $O9k; } function l9t($O9t,$O2e="application/json") { header($_SERVER["SERVER_PROTOCOL"]." ".$O9t); header("Access-Control-Allow-Origin: *"); header( "Content-Type: $O2e; charset=UTF-8"); } function l9u($O6g=TRUE) { $O9u=l6x(l12); if ($O9u == "") { l58(lr,$l2t=FALSE); $l9v=O4w("select ".lq." from ".lr." LIMIT 1",KIBELLADB,TABLESDIR,$l4x="query",$O24="sqlite"); if ($l9v !== FALSE && count($l9v)>0) { $l22=$l9v[0][lq]; } else { $l22=""; } } else { $l22=$O9u; } $O9v="{\"".lj."\":\"".O7."\",\"".Oj."\":\"config\",\"".lk."\":\"".l8."\",\"".Ok."\":1,\"".lo."\":true,\"".lm."\":{"."\"buildNum\":1000,"."\"defaultIndex\":\"".$l22."\""."}"."}"; if ($O6g) { $O9v="{\"docs\":[".$O9v."]}"; } O2f($O9v); } function O72($l9w) { $O9w="{\"took\":2,\"timed_out\":false,\"".ln."\":{\"total\":1,\"successful\":1,\"failed\":0},"."\"hits\":{"."\"total\":".count($l9w).","."\"max_score\":1,"."\"hits\":".json_encode($l9w)."}"."}"; O2f($O9w); } function l5x($O2e,$O28,$O5w,$l9x,$O9x) { $O9w="{\"".lj."\":\"".O7."\",\"".Oj."\":\"".$O2e."\",\"".lk."\":\"".$O28."\",\"".Ok."\":".$O5w.",\"".ln."\":{\"total\":2,\"successful\":1,\"failed\":0},\"".$l9x."\":".$O9x."}"; O2f($O9w); } function l9y($l9r,$O2l,$O9y="",$l9z=NULL,$O9z=NULL) { if ($l9z === NULL) $l9z=@strtotime("+365 days"); if ($O9z === NULL) $O9z="/".APPDIRNAME."/"; if ($O9y === "raw") { setrawcookie($l9r,$O2l,$l9z,$O9z); } else { setcookie($l9r,$O2l,$l9z,$O9z); } } function la0($Oa0,$la1,$Oa1) { $la2=""; $Oa2=""; if (strtolower($Oa1) == "begin") { if ($la1 == "" || $la1 == NULL) { $la3=$Oa0; $la1=""; } else $la3=str_replace($la1."/","",$Oa0); $l3c=0; $Oa3=""; if ($la3[0] == "/") { $l3c=1; $Oa3="/"; } if ($la1 == "") $la4=""; else $la4=$Oa3.$la1; $Oa1=strpos($la3,"/",$l3c); if ($Oa1 !== FALSE) { $la2=$la4.substr($la3,$Oa1); $Oa2=substr($la3,$l3c,$Oa1-$l3c); } else { $Oa4=la5($Oa0); $Oa5=$Oa4["URI"]; $Oa2=substr($Oa5,$l3c); } } else { $Oa4=la5($Oa0); $Oa5=$Oa4["URI"]; $la6=strlen($Oa5); if ($Oa5[$la6-1] == "/") $Oa5=substr($Oa5,0,$la6-1); $Oa1=strrpos($Oa5,"/"); if ($Oa1 !== FALSE) { if ($Oa1<strlen($Oa5)-1) $Oa2=substr($Oa5,$Oa1+1); $la2=substr($Oa5,0,$Oa1+1); } else $Oa2=$Oa5; } return array("URI" => $la2,"object" => $Oa2); } function la5($Oa0) { $Oa1=strpos($Oa0,"?"); if ($Oa1 === FALSE) { $Oa6=$Oa0; $O2i=NULL; } else { $Oa6=substr($Oa0,0,$Oa1); if ($Oa1 == strlen($Oa0)-1) { $O2i=NULL; } else { $la7=substr($Oa0,$Oa1+1); $Oa7=explode("&",$la7); $O2i=O30("=",$Oa7); } } return array("URI" => $Oa6,"params" => $O2i); } function l70($l2g) { $l2g=preg_replace("/\\s+/","-",$l2g); return $l2g; } function la8($l2g) { $l2g=urldecode($l2g); return $l2g; } function O9m($l2x,$Oa8=O8) { $l9s=time(); while (!file_exists($l2x) && (time()-$l9s)<=$Oa8) { sleep(1); } }