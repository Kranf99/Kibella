<?php
/*
JSON_SQL_Bridge 1.0
Copyright 2016 Frank Vanden berghen
All Right reserved.

JSON_SQL_Bridge is not a free software. The JSON_SQL_Bridge software is NOT licensed under the "Apache License". 
If you are interested in distributing, reselling, modifying, contibuting or in general creating 
any derivative work from JSON_SQL_Bridge, please contact Frank Vanden Berghen at frank@timi.eu.
*/
namespace kibella; function O7p($l7o,$O5s) { $Oat=FALSE; if ($O5s) { $Oau=$l7o["responseFileFinal"]; $lav=$l7o["responseFileTmp"]; $O3s=checkdirexistsorcreate(CACHEDIR); if ($O3s === FALSE) { showmessage( __FUNCTION__ ,TAG_ERROR,l88(CACHEDIR).Oav()); return FALSE; } if (file_exists($Oau) && !O4n($Oau)) { $Oat=TRUE; } else if (file_exists($lav)) { lau($Oau); if (file_exists($Oau)) { $Oat=TRUE; } } } return $Oat; } function l7r($l7o,$O5s) { if (file_exists($l7o["responseFileTmp"]) === TRUE) { $Oar=law($l7o); if ($Oar !== FALSE && PHP_SAPI !== "cli") { if ($l7o["responseFileFinal"] !== O7y(l14)) { setrawcookie(l14,$l7o["responseFileFinal"],strtotime("+365 days"),"/".APPDIRNAME."/"); setrawcookie(O14,time(),strtotime("+365 days"),"/".APPDIRNAME."/"); setrawcookie(l15,$O5s*1,strtotime("+365 days"),"/".APPDIRNAME."/"); } } } } function O7o($l31,$l7n) { if (is_string($l7n)) { $Oaw=$l7n; } else { $Oaw=serialize($l7n); } $Oau=CACHEDIR."/query_".$l31.O1y.md5($l31."\n".$Oaw).".json"; $lax="_tmp"; $lav= "$Oau$lax"; $l7o=array("responseFileFinal" => $Oau,"responseFileTmp" => $lav); return $l7o; } function Oaq($Oe) { $Oax=substr($Oe,strrpos($Oe,O1y)+1); $lay=strrpos($Oax,"."); if ($lay>0) { $l63=substr($Oax,0,$lay); } else { $l63=$Oax; } return $l63; } function O7y($Oay) { if ( isset ($_COOKIE[$Oay])) { return $_COOKIE[$Oay]; } else { return ""; } } function O7r($Oe,$laz=5) { $Oar=FALSE; if ($Oe !== NULL && $Oe !== FALSE && $Oe !== "") { $Oaz=time(); $lb0=strlen(ob_get_contents()); while ($Oar === FALSE && (time()-$Oaz)<=$laz) { @readfile($Oe); if (PHP_SAPI === "cli" || strlen(ob_get_contents())>$lb0 && @filesize($Oe)>0) $Oar=TRUE; } } return $Oar; } function law($l7o,$laz=5) { $Oar=FALSE; $Oaz=time(); while ($Oar === FALSE && (time()-$Oaz)<=$laz) { $Oar=@rename($l7o["responseFileTmp"],$l7o["responseFileFinal"]); } return $Oar; } function Ob0($lb1,$l52="application/json") { header($_SERVER["SERVER_PROTOCOL"]." ".$lb1); header("Access-Control-Allow-Origin: *"); header( "Content-Type: $l52; charset=UTF-8"); } function Ob1($O7k=TRUE) { $lb2=O7y(l1w); if ($lb2 == "") { l68(O1m,$O3r=FALSE); $O66=dbcreatedbh(KIBELLADB); $Ob2=dbdbhexecutesqlquery($O66->getdbhandle(),"select ".O3." from ".O1m." LIMIT 1"); $O66->close(); if ($Ob2 !== FALSE && count($Ob2)>0) { $O30=$Ob2[0][O3]; } else { $O30="INCOME(income)"; } } else { $O30=$lb2; } $lb3="{\"".l1f."\":\"".O12."\",\"".O1f."\":\"config\",\"".l1g."\":\"".l13."\",\"".O1g."\":1,\"".O1j."\":true,\"".O1h."\":{"."\"buildNum\":1000,"."\"defaultIndex\":\"".$O30."\""."}"."}"; if ($O7k) { $lb3="{\"docs\":[".$lb3."]}"; } O36($lb3); } function l84($Ob3) { $lb4="{\"took\":2,\"timed_out\":false,\"".O1i."\":{\"total\":1,\"successful\":1,\"failed\":0},"."\"hits\":{"."\"total\":".count($Ob3).","."\"max_score\":1,"."\"hits\":".json_encode($Ob3)."}"."}"; O36($lb4); } function O70($l52,$O1,$l70,$Ob4,$lb5) { $lb4="{\"".l1f."\":\"".O12."\",\"".O1f."\":\"".$l52."\",\"".l1g."\":\"".$O1."\",\"".O1g."\":".$l70.",\"".O1i."\":{\"total\":2,\"successful\":1,\"failed\":0},\"".$Ob4."\":".$lb5."}"; O36($lb4); } function Ob5($Oay,$l3c,$lb6="",$Ob6=NULL,$lb7=NULL) { if ($Ob6 === NULL) $Ob6=strtotime("+365 days"); if ($lb7 === NULL) $lb7="/".APPDIRNAME."/"; if ($lb6 === "raw") { setrawcookie($Oay,$l3c,$Ob6,$lb7); } else { setcookie($Oay,$l3c,$Ob6,$lb7); } } function Ob7($lb8,$Ob8,$l4v) { $lb9=""; $Ob9=""; if (strtolower($l4v) == "begin") { if ($Ob8 == "" || $Ob8 == NULL) { $lba=$lb8; $Ob8=""; } else $lba=str_replace($Ob8."/","",$lb8); $O4e=0; $Oba=""; if ($lba[0] == "/") { $O4e=1; $Oba="/"; } if ($Ob8 == "") $lbb=""; else $lbb=$Oba.$Ob8; $l4v=strpos($lba,"/",$O4e); if ($l4v !== FALSE) { $lb9=$lbb.substr($lba,$l4v); $Ob9=substr($lba,$O4e,$l4v-$O4e); } else { $Obb=lbc($lb8); $Obc=$Obb["URI"]; $Ob9=substr($Obc,$O4e); } } else { $Obb=lbc($lb8); $Obc=$Obb["URI"]; $lbd=strlen($Obc); if ($Obc[$lbd-1] == "/") $Obc=substr($Obc,0,$lbd-1); $l4v=strrpos($Obc,"/"); if ($l4v !== FALSE) { if ($l4v<strlen($Obc)-1) $Ob9=substr($Obc,$l4v+1); $lb9=substr($Obc,0,$l4v+1); } else $Ob9=$Obc; } return array("URI" => $lb9,"object" => $Ob9); } function lbc($lb8) { $l4v=strpos($lb8,"?"); if ($l4v === FALSE) { $Obd=$lb8; $l39=NULL; } else { $Obd=substr($lb8,0,$l4v); if ($l4v == strlen($lb8)-1) { $l39=NULL; } else { $lbe=substr($lb8,$l4v+1); $Obe=explode("&",$lbe); $l39=O40("=",$Obe); } } return array("URI" => $Obd,"params" => $l39); } function O81($O35) { $O35=preg_replace("/\\s+/","-",$O35); return $O35; } function lbf($O35) { $O35=urldecode($O35); return $O35; } function lau($O3w,$Obf=O13) { $Oaz=time(); while (!file_exists($O3w) && (time()-$Oaz)<=$Obf) { sleep(1); } }